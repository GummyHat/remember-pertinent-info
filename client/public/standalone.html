<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPI Course Prerequisite Tree - Remember Pertinent Info</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f4f7f6;
            --text-color: #333;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            --primary-color: #007bff;
            --shadow-color: rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --header-bg: #1e1e1e;
                --card-bg: #1e1e1e;
                --primary-color: #00aaff;
                --shadow-color: rgba(255, 255, 255, 0.1);
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        header {
            background: var(--header-bg);
            padding: 1rem 0;
            box-shadow: 0 2px 4px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .container { display: flex; justify-content: space-between; align-items: center; }

        h1 { font-size: 1.5rem; color: var(--primary-color); }

        .semester-selector {
            margin: 20px 0;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        select, input {
            padding: 10px 15px;
            font-size: 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            margin: 5px;
        }

        .search-section {
            margin: 30px 0;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .search-container { position: relative; max-width: 600px; }

        #course-search {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 400px;
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid var(--primary-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
            display: none;
            z-index: 1000;
        }

        .search-results.active { display: block; }

        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--shadow-color);
        }

        .search-result-item:hover { background: var(--bg-color); }

        .tree-visualization {
            min-height: 400px;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .tree-node {
            position: relative;
            display: inline-block;
            margin: 20px;
        }

        .tree-node-content {
            background: var(--card-bg);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 15px 20px;
            min-width: 200px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .tree-node-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .tree-node-content.root {
            border-width: 3px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #0099ff 100%);
            color: white;
        }

        .tree-node-content.root * { color: white; }

        .node-code {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .node-title {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .tree-children {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 40px;
            position: relative;
        }

        .tree-children::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--primary-color);
        }

        .tree-child {
            position: relative;
            flex: 0 1 auto;
        }

        .tree-child::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--primary-color);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid var(--shadow-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: var(--card-bg);
            border-radius: 6px;
            box-shadow: 0 2px 8px var(--shadow-color);
            font-size: 0.9rem;
        }

        .status.success { border-left: 4px solid #4caf50; }
        .status.error { border-left: 4px solid #f44336; }
        .status.info { border-left: 4px solid var(--primary-color); }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal.active { display: block; }

        .modal-content {
            background-color: var(--card-bg);
            margin: 3% auto;
            padding: 0;
            border: 1px solid var(--shadow-color);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #0099ff 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
        }

        .close {
            color: white;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .close:hover { opacity: 0.8; }

        .modal-body {
            padding: 30px;
        }

        .course-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .info-item {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
        }

        .info-label {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--primary-color);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            color: var(--text-color);
        }

        .section-card {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid var(--shadow-color);
        }

        .section-header {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .timeslot-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #4caf50;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }

        .badge-seats {
            background: #4caf50;
            color: white;
        }

        .badge-seats.low {
            background: #ff9800;
        }

        .badge-seats.full {
            background: #f44336;
        }

        .description-section {
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-color);
            border-radius: 8px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ðŸŽ“ RPI Course Prerequisite Tree</h1>
            <div>Live data from QUACS</div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="semester-selector">
                <label><strong>Select Semester:</strong></label>
                <select id="semester-select">
                    <option value="">Loading semesters...</option>
                </select>
                <span id="data-status">Initializing...</span>
            </div>

            <div class="search-section">
                <h2>Find Your Course</h2>
                <p>Search for any RPI course to see its prerequisite tree</p>
                <div class="search-container">
                    <input type="text" id="course-search" placeholder="Search by course code or name (e.g., CSCI-1200 or Data Structures)">
                    <div id="search-results" class="search-results"></div>
                </div>
            </div>

            <div id="tree-visualization" class="tree-visualization">
                <div class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading course data...</p>
                </div>
            </div>
        </div>
    </main>

    <div id="status-message" class="status" style="display: none;"></div>

    <!-- Course Detail Modal -->
    <div id="course-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2 id="modal-title">Course Details</h2>
            </div>
            <div class="modal-body" id="modal-body">
                Loading...
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // CONFIGURATION
        // ============================================================================

        // QUACS Data URLs - fetches live course data from GitHub
        const QUACS_BASE = 'https://raw.githubusercontent.com/quacs/quacs-data/master';
        const LATEST_SEMESTER = '202501'; // Spring 2025 - update this for new semesters

        // ============================================================================
        // GLOBAL STATE
        // ============================================================================

        // Cache for loaded data - prevents re-fetching
        let coursesData = {};        // All courses mapped by course ID (e.g., "CSCI-1200")
        let catalogData = {};        // Course descriptions and metadata
        let prerequisitesData = {};  // Prerequisites mapped by CRN
        let currentSemester = LATEST_SEMESTER;
        let searchTimeout;           // Debounce timer for search

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        /**
         * Initialize the application - loads semester list and default semester data
         */
        async function init() {
            showStatus('Loading course data from QUACS...', 'info');
            await loadSemesterList();
            await loadData(currentSemester);
        }

        /**
         * Load available semesters into dropdown
         * TODO: Fetch this dynamically from QUACS API
         */
        async function loadSemesterList() {
            // Currently hardcoded - could be fetched from QUACS meta.json
            const semesters = [
                { code: '202501', name: 'Spring 2025' },
                { code: '202409', name: 'Fall 2024' },
                { code: '202405', name: 'Summer 2024' },
                { code: '202401', name: 'Spring 2024' },
                { code: '202309', name: 'Fall 2023' }
            ];

            const select = document.getElementById('semester-select');
            select.innerHTML = semesters.map(s =>
                `<option value="${s.code}" ${s.code === currentSemester ? 'selected' : ''}>${s.name}</option>`
            ).join('');

            select.addEventListener('change', async (e) => {
                currentSemester = e.target.value;
                await loadData(currentSemester);
            });
        }

        // ============================================================================
        // DATA LOADING
        // ============================================================================

        /**
         * Load all course data for a specific semester from QUACS GitHub
         * @param {string} semester - Semester code (e.g., "202501" for Spring 2025)
         */
        async function loadData(semester) {
            try {
                showStatus('Loading data...', 'info');
                document.getElementById('data-status').textContent = 'Loading...';

                // Fetch all data in parallel for better performance
                const [courses, catalog, prereqs] = await Promise.all([
                    fetchJSON(`${QUACS_BASE}/semester_data/${semester}/courses.json`),
                    fetchJSON(`${QUACS_BASE}/semester_data/${semester}/catalog.json`),
                    fetchJSON(`${QUACS_BASE}/semester_data/${semester}/prerequisites.json`)
                ]);

                coursesData = processCourses(courses);
                catalogData = catalog;
                prerequisitesData = prereqs;

                document.getElementById('data-status').textContent = `âœ“ Loaded ${Object.keys(coursesData).length} courses`;
                showStatus('Data loaded successfully!', 'success');
                setTimeout(() => hideStatus(), 3000);

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('data-status').textContent = 'âœ— Error loading data';
                showStatus('Error loading QUACS data. Using cached data if available.', 'error');
            }
        }

        async function fetchJSON(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        }

        /**
         * Convert course array (grouped by department) into a flat map by course ID
         * @param {Array} courseArray - Array of departments with courses
         * @returns {Object} Map of courseId -> course data
         */
        function processCourses(courseArray) {
            const courseMap = {};
            courseArray.forEach(dept => {
                dept.courses.forEach(course => {
                    courseMap[course.id] = {
                        ...course,
                        dept: dept.code  // Add department code for easy reference
                    };
                });
            });
            return courseMap;
        }

        // ============================================================================
        // SEARCH FUNCTIONALITY
        // ============================================================================

        /**
         * Real-time search - triggers on user input with debouncing
         */
        document.getElementById('course-search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim().toLowerCase();

            if (query.length < 2) {
                document.getElementById('search-results').classList.remove('active');
                return;
            }

            searchTimeout = setTimeout(() => searchCourses(query), 300);
        });

        /**
         * Search courses by code, name, or description
         * @param {string} query - Search query (lowercase)
         */
        function searchCourses(query) {
            // Search across course ID, name, and description
            const results = Object.entries(coursesData)
                .filter(([id, course]) => {
                    const catalog = catalogData[id] || {};
                    return id.toLowerCase().includes(query) ||
                           (catalog.name || '').toLowerCase().includes(query) ||
                           (catalog.description || '').toLowerCase().includes(query);
                })
                .slice(0, 20);

            const resultsDiv = document.getElementById('search-results');

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="search-result-item">No courses found</div>';
            } else {
                resultsDiv.innerHTML = results.map(([id, course]) => {
                    const catalog = catalogData[id] || {};
                    return `
                        <div class="search-result-item" onclick="loadCourseTree('${id}')">
                            <div style="font-weight: 600; color: var(--primary-color);">${id}</div>
                            <div style="font-size: 0.9rem;">${catalog.name || 'Unknown Course'}</div>
                        </div>
                    `;
                }).join('');
            }

            resultsDiv.classList.add('active');
        }

        // ============================================================================
        // PREREQUISITE TREE BUILDING
        // ============================================================================

        /**
         * Load and display prerequisite tree for a course
         * @param {string} courseId - Course ID (e.g., "CSCI-1200")
         */
        function loadCourseTree(courseId) {
            document.getElementById('search-results').classList.remove('active');
            document.getElementById('course-search').value = courseId;

            const treeDiv = document.getElementById('tree-visualization');
            treeDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Building prerequisite tree...</p></div>';

            setTimeout(() => {
                try {
                    const tree = buildPrerequisiteTree(courseId, 0, new Set());
                    if (tree) {
                        treeDiv.innerHTML = renderTree(tree, true);
                    } else {
                        treeDiv.innerHTML = '<div class="loading"><p>Course not found</p></div>';
                    }
                } catch (error) {
                    console.error('Error building tree:', error);
                    treeDiv.innerHTML = `<div class="loading"><p>Error: ${error.message}</p></div>`;
                }
            }, 100);
        }

        /**
         * Recursively build prerequisite tree structure
         * @param {string} courseId - Course to build tree for
         * @param {number} depth - Current recursion depth (prevents infinite loops)
         * @param {Set} visited - Set of already visited courses (prevents cycles)
         * @returns {Object|null} Tree node or null if not found
         */
        function buildPrerequisiteTree(courseId, depth, visited) {
            // Prevent infinite recursion and circular dependencies
            if (depth > 5 || visited.has(courseId)) return null;
            visited.add(courseId);

            const course = coursesData[courseId];
            const catalog = catalogData[courseId] || {};

            if (!course) return null;

            const node = {
                id: courseId,
                title: catalog.name || courseId,
                description: catalog.description || '',
                depth: depth,
                prerequisites: []
            };

            // Find prerequisites from any section of this course
            const section = course.sections && course.sections[0];
            if (section && section.crn) {
                const prereqData = prerequisitesData[section.crn];
                if (prereqData && prereqData.prerequisites) {
                    node.prerequisites = parsePrerequisites(prereqData.prerequisites, depth + 1, new Set(visited));
                }
            }

            return node;
        }

        /**
         * Parse prerequisite data structure (handles AND/OR logic)
         * @param {Object} prereqData - Prerequisite data from QUACS
         * @param {number} depth - Current recursion depth
         * @param {Set} visited - Set of visited courses
         * @returns {Array} Array of prerequisite tree nodes
         */
        function parsePrerequisites(prereqData, depth, visited) {
            if (!prereqData || typeof prereqData !== 'object') return [];

            const prereqs = [];

            // Handle direct course prerequisite (e.g., "MATH 1010")
            if (prereqData.type === 'course' && prereqData.course) {
                const parts = prereqData.course.split(' ');
                if (parts.length >= 2) {
                    const courseId = `${parts[0]}-${parts[1]}`;
                    const subtree = buildPrerequisiteTree(courseId, depth, new Set(visited));
                    if (subtree) {
                        subtree.minGrade = prereqData.min_grade || 'D';
                        prereqs.push(subtree);
                    }
                }
            }

            // Handle nested prerequisites (AND/OR groups)
            // Example: (PHYS-1100 OR PHYS-1150) AND MATH-1020
            if (prereqData.nested && Array.isArray(prereqData.nested)) {
                prereqData.nested.forEach(item => {
                    const subPrereqs = parsePrerequisites(item, depth, visited);
                    prereqs.push(...subPrereqs.map(p => ({
                        ...p,
                        relationship: prereqData.type || 'and'
                    })));
                });
            }

            return prereqs;
        }

        // ============================================================================
        // RENDERING
        // ============================================================================

        /**
         * Render prerequisite tree as HTML
         * @param {Object} node - Tree node to render
         * @param {boolean} isRoot - Whether this is the root node
         * @returns {string} HTML string
         */
        function renderTree(node, isRoot = false) {
            if (!node) return '';

            const hasPrereqs = node.prerequisites && node.prerequisites.length > 0;

            return `
                <div class="tree-node">
                    <div class="tree-node-content ${isRoot ? 'root' : ''}"
                         onclick="showCourseDetail('${node.id}')"
                         title="Click to view full course details">
                        <div class="node-code">${node.id}</div>
                        <div class="node-title">${node.title}</div>
                        ${node.minGrade && !isRoot ? `<div style="font-size: 0.8rem; font-style: italic;">Min Grade: ${node.minGrade}</div>` : ''}
                    </div>
                    ${hasPrereqs ? `
                        <div class="tree-children">
                            ${node.prerequisites.map(prereq => `
                                <div class="tree-child">${renderTree(prereq, false)}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        /**
         * Format military time to 12-hour format
         * @param {number} time - Time in format HHMM (e.g., 1350 for 1:50 PM)
         * @returns {string} Formatted time (e.g., "1:50 PM")
         */
        function formatTime(time) {
            if (time === -1 || !time) return 'TBA';
            const hours = Math.floor(time / 100);
            const minutes = time % 100;
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }

        // ============================================================================
        // COURSE DETAIL MODAL
        // ============================================================================

        /**
         * Display complete course information in modal
         * Shows: description, sections, CRNs, instructors, times, seats, etc.
         * @param {string} courseId - Course ID to display
         */
        function showCourseDetail(courseId) {
            const modal = document.getElementById('course-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            const course = coursesData[courseId];
            const catalog = catalogData[courseId] || {};

            if (!course) {
                modalBody.innerHTML = '<p>Course data not found.</p>';
                modal.classList.add('active');
                return;
            }

            modalTitle.textContent = `${courseId}: ${catalog.name || 'Unknown Course'}`;

            let html = '';

            // Description
            if (catalog.description) {
                html += `
                    <div class="description-section">
                        <h3 style="margin-top: 0; color: var(--primary-color);">Description</h3>
                        <p>${catalog.description}</p>
                    </div>
                `;
            }

            // Course info
            html += `
                <h3 style="color: var(--primary-color); margin-top: 20px;">Course Information</h3>
                <div class="course-info-grid">
                    <div class="info-item">
                        <div class="info-label">Course Code</div>
                        <div class="info-value">${courseId}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Subject</div>
                        <div class="info-value">${course.subj || catalog.subj || 'N/A'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Course Number</div>
                        <div class="info-value">${course.crse || catalog.crse || 'N/A'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Department</div>
                        <div class="info-value">${course.dept || 'N/A'}</div>
                    </div>
                    ${catalog.source ? `
                        <div class="info-item">
                            <div class="info-label">Source</div>
                            <div class="info-value">${catalog.source}</div>
                        </div>
                    ` : ''}
                </div>
            `;

            // Sections
            if (course.sections && course.sections.length > 0) {
                html += '<h3 style="color: var(--primary-color); margin-top: 30px;">Available Sections</h3>';

                course.sections.forEach((section, idx) => {
                    const seatPercent = section.cap > 0 ? (section.rem / section.cap) * 100 : 0;
                    const seatClass = section.rem === 0 ? 'full' : (seatPercent < 20 ? 'low' : '');

                    html += `
                        <div class="section-card">
                            <div class="section-header">
                                Section ${section.sec || 'N/A'}
                                ${section.rem !== undefined ? `
                                    <span class="badge badge-seats ${seatClass}">
                                        ${section.rem}/${section.cap} Seats Available
                                    </span>
                                ` : ''}
                            </div>

                            <div class="course-info-grid">
                                <div class="info-item">
                                    <div class="info-label">CRN</div>
                                    <div class="info-value">${section.crn || 'N/A'}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Section</div>
                                    <div class="info-value">${section.sec || 'N/A'}</div>
                                </div>
                                ${section.act !== undefined ? `
                                    <div class="info-item">
                                        <div class="info-label">Activity Code</div>
                                        <div class="info-value">${section.act}</div>
                                    </div>
                                ` : ''}
                                ${section.credMin !== undefined || section.credMax !== undefined ? `
                                    <div class="info-item">
                                        <div class="info-label">Credits</div>
                                        <div class="info-value">
                                            ${section.credMin === section.credMax ?
                                                section.credMin :
                                                `${section.credMin || 0} - ${section.credMax || 0}`}
                                        </div>
                                    </div>
                                ` : ''}
                                ${section.cap !== undefined ? `
                                    <div class="info-item">
                                        <div class="info-label">Capacity</div>
                                        <div class="info-value">${section.cap}</div>
                                    </div>
                                ` : ''}
                                ${section.rem !== undefined ? `
                                    <div class="info-item">
                                        <div class="info-label">Remaining Seats</div>
                                        <div class="info-value">${section.rem}</div>
                                    </div>
                                ` : ''}
                            </div>

                            ${section.attribute ? `
                                <p style="margin-top: 10px; font-style: italic; color: var(--primary-color);">
                                    <strong>Attribute:</strong> ${section.attribute}
                                </p>
                            ` : ''}

                            ${section.title ? `
                                <p style="margin-top: 10px;">
                                    <strong>Title:</strong> ${section.title}
                                </p>
                            ` : ''}

                            ${section.timeslots && section.timeslots.length > 0 ? `
                                <h4 style="margin-top: 20px; color: var(--primary-color);">Timeslots</h4>
                                ${section.timeslots.map(slot => `
                                    <div class="timeslot-card">
                                        ${slot.instructor ? `
                                            <p><strong>Instructor:</strong> ${slot.instructor}</p>
                                        ` : ''}
                                        ${slot.days && slot.days.length > 0 ? `
                                            <p><strong>Days:</strong> ${slot.days.join(', ')}</p>
                                        ` : ''}
                                        ${slot.timeStart && slot.timeStart !== -1 ? `
                                            <p><strong>Time:</strong> ${formatTime(slot.timeStart)} - ${formatTime(slot.timeEnd)}</p>
                                        ` : '<p><strong>Time:</strong> TBA</p>'}
                                        ${slot.location ? `
                                            <p><strong>Location:</strong> ${slot.location}</p>
                                        ` : ''}
                                        ${slot.dateStart || slot.dateEnd ? `
                                            <p><strong>Duration:</strong> ${slot.dateStart || 'N/A'} to ${slot.dateEnd || 'N/A'}</p>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            ` : '<p style="font-style: italic; color: #666;">No timeslot information available</p>'}
                        </div>
                    `;
                });
            } else {
                html += '<p style="margin-top: 20px; font-style: italic; color: #666;">No sections available for this course in the selected semester.</p>';
            }

            modalBody.innerHTML = html;
            modal.classList.add('active');
        }

        // ============================================================================
        // UI HELPERS
        // ============================================================================

        /**
         * Modal close handlers - close on X click or outside click
         */
        const modal = document.getElementById('course-modal');
        const closeBtn = document.querySelector('.close');

        closeBtn.onclick = function() {
            modal.classList.remove('active');
        }

        window.onclick = function(event) {
            if (event.target === modal) {
                modal.classList.remove('active');
            }
        }

        /**
         * Show status message (success/error/info)
         * @param {string} message - Message to display
         * @param {string} type - Type: 'success', 'error', or 'info'
         */
        function showStatus(message, type) {
            const status = document.getElementById('status-message');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status-message').style.display = 'none';
        }

        // ============================================================================
        // EVENT LISTENERS
        // ============================================================================

        // Close search results when clicking outside the search area
        document.addEventListener('click', (e) => {
            const search = document.getElementById('course-search');
            const results = document.getElementById('search-results');
            if (!search.contains(e.target) && !results.contains(e.target)) {
                results.classList.remove('active');
            }
        });

        // ============================================================================
        // APP STARTUP
        // ============================================================================

        // Initialize the application when the page loads
        init();
    </script>
</body>
</html>
